<!-- Settings Section with Tabs -->
<section id="settings" class="content-section">
    <div class="mb-8">
        <h2 class="text-4xl font-bold text-cyan-300 mb-2">Configurações</h2>
        <p class="text-gray-400">Gerencie as configurações do sistema</p>
    </div>
    
    <!-- Tabs Navigation -->
    <div class="glass-effect rounded-xl mb-6">
        <div class="flex border-b border-gray-600">
            <button class="settings-tab-btn px-6 py-4 text-cyan-300 border-b-2 border-cyan-500 bg-gray-700/30" data-tab="branding">
                <i class="fas fa-palette mr-2"></i>Marca e Visual
            </button>
            <button class="settings-tab-btn px-6 py-4 text-gray-400 hover:text-cyan-300 transition-colors" data-tab="general">
                <i class="fas fa-cog mr-2"></i>Configurações Gerais
            </button>
            <button class="settings-tab-btn px-6 py-4 text-gray-400 hover:text-cyan-300 transition-colors" data-tab="api">
                <i class="fas fa-key mr-2"></i>Chaves de API
            </button>
            <button class="settings-tab-btn px-6 py-4 text-gray-400 hover:text-cyan-300 transition-colors" data-tab="security">
                <i class="fas fa-shield-alt mr-2"></i>Segurança
            </button>
            <button class="settings-tab-btn px-6 py-4 text-gray-400 hover:text-cyan-300 transition-colors" data-tab="advanced">
                <i class="fas fa-tools mr-2"></i>Avançado
            </button>
        </div>
    </div>
    
    <!-- Tab Contents -->
    <div class="space-y-8">
        
        <!-- Branding Tab -->
        <div id="branding-tab" class="settings-tab-content">
            <div class="glass-effect p-6 rounded-xl shadow-lg card-hover">
                <h3 class="text-2xl font-semibold mb-6 text-cyan-300 border-b border-gray-600 pb-2">
                    <i class="fas fa-palette mr-2"></i>Personalização da Marca
                </h3>
                
                <!-- Live Preview -->
                <div class="mb-6 p-4 bg-gray-800/50 rounded-lg border border-gray-600">
                    <h4 class="text-lg font-semibold text-cyan-300 mb-3">Pré-visualização</h4>
                    <div class="flex items-center space-x-4 p-4 bg-gray-900 rounded-lg">
                        <div class="w-12 h-12 bg-gradient-to-r from-cyan-600 to-cyan-700 rounded-lg flex items-center justify-center" id="logo-preview">
                            <i class="fas fa-download text-white text-xl"></i>
                        </div>
                        <div>
                            <h5 class="text-white font-bold" id="app-name-preview">{{ app_settings.app_name if app_settings else 'YTDL Web API' }}</h5>
                            <p class="text-gray-400 text-sm">Sistema de Download de Mídia</p>
                        </div>
                    </div>
                </div>
                
                <form action="{{ url_for('admin.update_app_settings') }}" method="POST" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="app_name" class="block text-sm font-medium text-gray-400 mb-2">Nome da Aplicação</label>
                            <input type="text" name="app_name" id="app_name" 
                                   value="{{ app_settings.app_name if app_settings else 'YTDL Web API' }}" 
                                   class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500"
                                   onkeyup="updatePreview()">
                        </div>
                        <div>
                            <label for="app_logo" class="block text-sm font-medium text-gray-400 mb-2">URL do Logo</label>
                            <input type="url" name="app_logo" id="app_logo" 
                                   value="{{ app_settings.app_logo if app_settings else '' }}" 
                                   placeholder="https://exemplo.com/logo.png" 
                                   class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500"
                                   onkeyup="updatePreview()">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="primary_color" class="block text-sm font-medium text-gray-400 mb-2">Cor Primária</label>
                            <div class="flex space-x-2">
                                <input type="color" name="primary_color" id="primary_color" 
                                       value="{{ app_settings.primary_color if app_settings else '#0891b2' }}" 
                                       class="w-16 h-12 bg-gray-700/50 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500"
                                       onchange="updatePreview()">
                                <input type="text" id="primary_color_text" 
                                       value="{{ app_settings.primary_color if app_settings else '#0891b2' }}" 
                                       class="flex-1 bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"
                                       onkeyup="syncColorInput('primary')">
                            </div>
                        </div>
                        <div>
                            <label for="secondary_color" class="block text-sm font-medium text-gray-400 mb-2">Cor Secundária</label>
                            <div class="flex space-x-2">
                                <input type="color" name="secondary_color" id="secondary_color" 
                                       value="{{ app_settings.secondary_color if app_settings else '#0e7490' }}" 
                                       class="w-16 h-12 bg-gray-700/50 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500"
                                       onchange="updatePreview()">
                                <input type="text" id="secondary_color_text" 
                                       value="{{ app_settings.secondary_color if app_settings else '#0e7490' }}" 
                                       class="flex-1 bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"
                                       onkeyup="syncColorInput('secondary')">
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="favicon_url" class="block text-sm font-medium text-gray-400 mb-2">URL do Favicon</label>
                            <input type="url" name="favicon_url" id="favicon_url" 
                                   value="{{ app_settings.favicon_url if app_settings else '' }}" 
                                   placeholder="https://exemplo.com/favicon.ico" 
                                   class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500">
                        </div>
                        <div>
                            <label for="footer_text" class="block text-sm font-medium text-gray-400 mb-2">Texto do Rodapé</label>
                            <input type="text" name="footer_text" id="footer_text" 
                                   value="{{ app_settings.footer_text if app_settings else '© 2024 YTDL Web API' }}" 
                                   class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500">
                        </div>
                    </div>
                    
                    <button type="submit" class="py-3 px-6 rounded-lg text-white font-semibold bg-gradient-to-r from-cyan-600 to-cyan-700 hover:from-cyan-700 hover:to-cyan-800 transition-all">
                        <i class="fas fa-save mr-2"></i>Salvar Personalização
                    </button>
                </form>
            </div>
        </div>
        
        <!-- General Tab -->
        <div id="general-tab" class="settings-tab-content hidden">
            <div class="glass-effect p-6 rounded-xl shadow-lg card-hover">
                <h3 class="text-2xl font-semibold mb-6 text-cyan-300 border-b border-gray-600 pb-2">
                    <i class="fas fa-cog mr-2"></i>Configurações Gerais
                </h3>
                <form action="{{ url_for('admin.update_settings') }}" method="POST" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="rate_limit" class="block text-sm font-medium text-gray-400 mb-2">Limite de Requisições</label>
                            <input type="text" name="rate_limit" id="rate_limit" 
                                   value="{{ settings.DEFAULT_RATE_LIMIT }}" 
                                   class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500">
                            <p class="text-xs text-gray-500 mt-1">Ex: "20 per minute", "100 per hour"</p>
                        </div>
                        <div>
                            <label for="timeout" class="block text-sm font-medium text-gray-400 mb-2">Timeout da Resposta (segundos)</label>
                            <input type="number" name="timeout" id="timeout" 
                                   value="{{ settings.TASK_COMPLETION_TIMEOUT }}" 
                                   class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500">
                            <p class="text-xs text-gray-500 mt-1">Tempo limite para aguardar conclusão de tarefas</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="max_file_size" class="block text-sm font-medium text-gray-400 mb-2">Tamanho Máximo de Arquivo (MB)</label>
                            <input type="number" name="max_file_size" id="max_file_size" 
                                   value="{{ settings.MAX_FILE_SIZE_MB or 500 }}" 
                                   class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500">
                        </div>
                        <div>
                            <label for="auto_cleanup_days" class="block text-sm font-medium text-gray-400 mb-2">Limpeza Automática (dias)</label>
                            <input type="number" name="auto_cleanup_days" id="auto_cleanup_days" 
                                   value="{{ settings.AUTO_CLEANUP_DAYS or 30 }}" 
                                   class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500">
                            <p class="text-xs text-gray-500 mt-1">0 = desabilitado</p>
                        </div>
                    </div>
                    
                    <button type="submit" class="py-3 px-6 rounded-lg text-white font-semibold bg-gradient-to-r from-cyan-600 to-cyan-700 hover:from-cyan-700 hover:to-cyan-800 transition-all">
                        <i class="fas fa-save mr-2"></i>Salvar Configurações
                    </button>
                </form>
            </div>
        </div>
        
        <!-- API Keys Tab -->
        <div id="api-tab" class="settings-tab-content hidden">
            <div class="glass-effect p-6 rounded-xl shadow-lg card-hover">
                <h3 class="text-2xl font-semibold mb-6 text-cyan-300 border-b border-gray-600 pb-2">
                    <i class="fas fa-key mr-2"></i>Chaves de API
                </h3>
                
                <div class="space-y-4 mb-6" id="api-keys-list">
                    {% for key in api_keys %}
                    <div class="flex items-center justify-between bg-gray-700/30 p-4 rounded-lg border border-gray-600 api-key-item" data-key-id="{{ key.id }}">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3">
                                <span class="font-mono text-sm text-white">{{ key.key }}</span>
                                <button class="copy-key-btn text-gray-400 hover:text-cyan-300 transition-colors" data-key="{{ key.key }}">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            <div class="flex items-center space-x-4 mt-2">
                                <span class="text-sm text-gray-400">{{ key.name or 'Sem nome' }}</span>
                                <span class="text-xs text-gray-500">
                                    Criada: {{ key.created_at.strftime('%d/%m/%Y %H:%M') }}
                                </span>
                                {% if key.last_used %}
                                <span class="text-xs text-gray-500">
                                    Último uso: {{ key.last_used.strftime('%d/%m/%Y %H:%M') }}
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <button class="delete-api-key-btn text-red-400 hover:text-red-300 p-2 rounded-lg hover:bg-red-900/20 transition-all" data-key="{{ key.key }}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    {% else %}
                    <p class="text-gray-500 text-center py-8">Nenhuma chave de API configurada.</p>
                    {% endfor %}
                </div>
                
                <form id="new-api-key-form" class="flex gap-4">
                    <input type="text" name="name" placeholder="Nome da chave (opcional)" 
                           class="flex-1 bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500">
                    <button type="submit" class="py-3 px-6 rounded-lg text-white font-semibold bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 transition-all">
                        <i class="fas fa-plus mr-2"></i>Gerar Nova Chave
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Security Tab -->
        <div id="security-tab" class="settings-tab-content hidden">
            <div class="space-y-6">
                <!-- Change Password -->
                <div class="glass-effect p-6 rounded-xl shadow-lg card-hover">
                    <h3 class="text-2xl font-semibold mb-6 text-yellow-400 border-b border-yellow-500/30 pb-2">
                        <i class="fas fa-lock mr-2"></i>Alterar Senha
                    </h3>
                    <form action="{{ url_for('admin.change_password') }}" method="POST" class="space-y-4">
                        <div>
                            <label for="new_password_dash" class="block text-sm font-medium text-gray-400 mb-2">Nova Senha</label>
                            <input type="password" name="new_password" id="new_password_dash" required 
                                   class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                        </div>
                        <button type="submit" class="py-3 px-6 rounded-lg text-white bg-gradient-to-r from-yellow-600 to-yellow-700 hover:from-yellow-700 hover:to-yellow-800 transition-all">
                            <i class="fas fa-key mr-2"></i>Alterar Senha
                        </button>
                    </form>
                </div>
                
                <!-- Cookie Management -->
                <div class="glass-effect p-6 rounded-xl shadow-lg card-hover">
                    <h3 class="text-2xl font-semibold mb-6 text-orange-400 border-b border-orange-500/30 pb-2">
                        <i class="fas fa-cookie-bite mr-2"></i>Gerenciamento de Cookies
                    </h3>
                    
                    <!-- Cookie Status -->
                    <div class="mb-6 p-4 bg-gray-800/50 rounded-lg border border-gray-600">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                {% if cookie_status == 'ok' %}
                                    <span class="cookie-status valid">
                                        <i class="fas fa-check-circle mr-1"></i>Cookies Válidos
                                    </span>
                                    <span class="text-sm text-gray-400">Funcionando corretamente</span>
                                {% elif cookie_status == 'expired' %}
                                    <span class="cookie-status expired">
                                        <i class="fas fa-exclamation-triangle mr-1"></i>Cookies Expirados
                                    </span>
                                    <span class="text-sm text-gray-400">Precisam ser atualizados</span>
                                {% elif cookie_status == 'needs_sync' %}
                                    <span class="cookie-status needs_sync">
                                        <i class="fas fa-sync mr-1"></i>Precisa Sincronizar
                                    </span>
                                    <span class="text-sm text-gray-400">No banco, mas não no filesystem</span>
                                {% else %}
                                    <span class="cookie-status none">
                                        <i class="fas fa-exclamation-triangle mr-1"></i>Sem Cookies
                                    </span>
                                    <span class="text-sm text-gray-400">Alguns vídeos podem requerer autenticação</span>
                                {% endif %}
                            </div>
                            
                            {% if cookie_file_exists %}
                                <button class="sync-cookies-btn py-2 px-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white text-sm rounded-lg transition-all">
                                    <i class="fas fa-sync mr-2"></i>Sincronizar
                                </button>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <form action="{{ url_for('admin.upload_cookies') }}" method="POST" enctype="multipart/form-data">
                            <label for="cookie_file" class="w-full cursor-pointer text-center block py-3 px-4 rounded-lg text-white bg-gradient-to-r from-cyan-600 to-cyan-700 hover:from-cyan-700 hover:to-cyan-800 transition-all">
                                <i class="fas fa-upload mr-2"></i>{{ 'Substituir Cookies' if cookie_file_exists else 'Carregar Cookies' }}
                            </label>
                            <input type="file" name="cookie_file" id="cookie_file" class="hidden" accept=".txt" onchange="this.form.submit()">
                        </form>
                        
                        {% if cookie_file_exists %}
                        <button class="delete-cookies-btn w-full py-3 px-4 rounded-lg text-white bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 transition-all">
                            <i class="fas fa-trash mr-2"></i>Remover Cookies
                        </button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Advanced Tab -->
        <div id="advanced-tab" class="settings-tab-content hidden">
            <div class="space-y-6">
                <!-- System Maintenance -->
                <div class="glass-effect p-6 rounded-xl shadow-lg card-hover border border-red-500/30">
                    <h3 class="text-2xl font-semibold mb-6 text-red-400 border-b border-red-500/30 pb-2">
                        <i class="fas fa-exclamation-triangle mr-2"></i>Manutenção do Sistema
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <h4 class="font-semibold text-yellow-400">Limpeza de Dados</h4>
                            <button class="cleanup-files-btn w-full py-3 px-4 rounded-lg text-white bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 transition-all">
                                <i class="fas fa-broom mr-2"></i>Limpar Arquivos Ausentes
                            </button>
                            <button class="clear-history-btn w-full py-3 px-4 rounded-lg text-white bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 transition-all">
                                <i class="fas fa-trash mr-2"></i>Limpar Histórico
                            </button>
                        </div>
                        
                        <div class="space-y-4">
                            <h4 class="font-semibold text-blue-400">Informações do Sistema</h4>
                            <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-600">
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Total de Arquivos:</span>
                                        <span class="text-white">{{ stats.total_files }}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Espaço Usado:</span>
                                        <span class="text-white">{{ stats.total_size_mb }} MB</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Requisições Totais:</span>
                                        <span class="text-white">{{ stats.total_requests }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
// Settings tabs functionality
function initSettingsTabs() {
    const tabButtons = document.querySelectorAll('.settings-tab-btn');
    const tabContents = document.querySelectorAll('.settings-tab-content');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const targetTab = button.dataset.tab;
            
            // Update button states
            tabButtons.forEach(btn => {
                btn.classList.remove('text-cyan-300', 'border-b-2', 'border-cyan-500', 'bg-gray-700/30');
                btn.classList.add('text-gray-400');
            });
            button.classList.remove('text-gray-400');
            button.classList.add('text-cyan-300', 'border-b-2', 'border-cyan-500', 'bg-gray-700/30');
            
            // Update content visibility
            tabContents.forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${targetTab}-tab`).classList.remove('hidden');
        });
    });
}

// Live preview for branding
function updatePreview() {
    const appName = document.getElementById('app_name').value;
    const appLogo = document.getElementById('app_logo').value;
    const primaryColor = document.getElementById('primary_color').value;
    
    document.getElementById('app-name-preview').textContent = appName || 'YTDL Web API';
    
    const logoPreview = document.getElementById('logo-preview');
    if (appLogo) {
        logoPreview.innerHTML = `<img src="${appLogo}" alt="Logo" class="w-full h-full object-contain rounded-lg">`;
    } else {
        logoPreview.innerHTML = '<i class="fas fa-download text-white text-xl"></i>';
    }
    
    logoPreview.style.background = `linear-gradient(135deg, ${primaryColor}, ${primaryColor}dd)`;
}

// Sync color inputs
function syncColorInput(type) {
    const colorPicker = document.getElementById(`${type}_color`);
    const textInput = document.getElementById(`${type}_color_text`);
    
    if (type === 'primary') {
        colorPicker.value = textInput.value;
    } else {
        colorPicker.value = textInput.value;
    }
    updatePreview();
}

// Initialize when DOM loads
document.addEventListener('DOMContentLoaded', initSettingsTabs);
</script>